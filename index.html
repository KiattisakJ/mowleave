<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡∏≤ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏°‡πà‡∏≠‡πâ‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/KiattisakJ/mowleave/main/logo.png">
    <link rel="shortcut icon" type="image/png" href="https://raw.githubusercontent.com/KiattisakJ/mowleave/main/logo.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/KiattisakJ/mowleave/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .hover-scale { transition: transform 0.2s; }
        .hover-scale:hover { transform: scale(1.02); }
        .login-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen login-bg flex items-center justify-center">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="mb-4">
                    <img src="https://raw.githubusercontent.com/KiattisakJ/mowleave/main/logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏°‡πà‡∏≠‡πâ‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°" class="w-20 h-20 mx-auto object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="text-6xl hidden">üè´</div>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡∏≤</h1>
                <p class="text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏°‡πà‡∏≠‡πâ‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ Username</label>
                    <input type="text" id="loginUsername" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üîí Password</label>
                    <input type="password" id="loginPassword" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                </div>
                
                <div id="loginError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-sm">
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-6 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition duration-200 hover-scale">
                    üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
            

        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <div class="gradient-bg text-white py-6 mb-8">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center">
                    <div class="text-center flex-1">
                        <div class="flex items-center justify-center space-x-3">
                            <img src="https://raw.githubusercontent.com/KiattisakJ/mowleave/main/logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏°‡πà‡∏≠‡πâ‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°" class="w-10 h-10 object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-3xl hidden">üè´</span>
                            <h1 class="text-3xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡∏≤</h1>
                        </div>
                        <p class="text-blue-100 mt-2">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏°‡πà‡∏≠‡πâ‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right cursor-pointer hover:bg-white hover:bg-opacity-10 p-2 rounded-lg transition duration-200" onclick="showUserProfile()" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß">
                            <div id="currentUserName" class="font-semibold"></div>
                            <div id="currentUserLevel" class="text-sm text-blue-100"></div>
                        </div>
                        <button id="logoutBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
                            <span>üö™</span>
                            <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    <div class="container mx-auto px-4 max-w-7xl">
        <!-- Navigation -->
        <div class="flex justify-center items-center mb-8 gap-4">
            <div class="bg-white rounded-lg p-2 card-shadow">
                <button id="homeTab" class="px-6 py-3 rounded-lg bg-blue-500 text-white font-medium">üìä ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
                <button id="addTab" class="px-6 py-3 rounded-lg text-gray-600 hover:bg-gray-100 font-medium ml-2">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button id="teacherManageTab" class="px-6 py-3 rounded-lg text-gray-600 hover:bg-gray-100 font-medium ml-2">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏π</button>
                <button id="detailTab" class="px-6 py-3 rounded-lg text-gray-600 hover:bg-gray-100 font-medium ml-2 hidden">üë§ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏£‡∏π</button>
            </div>
        </div>

        <!-- Home Page -->
        <div id="homePage">
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <!-- Pending Approvals Table -->
                <div id="pendingApprovalsSection" class="mb-8">
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white p-4 rounded-t-lg">
                        <h3 class="text-lg font-bold flex items-center">
                            ‚è≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤
                            <span id="pendingCount" class="ml-2 bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </h3>
                        <p class="text-yellow-100 text-sm mt-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                    </div>
                    
                    <div class="bg-white border-x border-b rounded-b-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody id="pendingApprovalsTable" class="divide-y divide-gray-200">
                                    <!-- Pending approvals will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="noPendingMessage" class="hidden text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">‚úÖ</div>
                            <p class="text-lg font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                            <p class="text-sm">‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÅ‡∏•‡πâ‡∏ß</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Leaves Table -->
                <div id="recentLeavesSection" class="mb-8">
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-4 rounded-t-lg">
                        <h3 class="text-lg font-bold flex items-center">
                            üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 5 ‡∏ß‡∏±‡∏ô
                            <span id="recentCount" class="ml-2 bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </h3>
                        <p class="text-indigo-100 text-sm mt-1">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏•‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                    </div>
                    
                    <div class="bg-white border-x border-b rounded-b-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
                                    </tr>
                                </thead>
                                <tbody id="recentLeavesTable" class="divide-y divide-gray-200">
                                    <!-- Recent leaves will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="noRecentMessage" class="hidden text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üìÖ</div>
                            <p class="text-lg font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡πÉ‡∏ô 5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</p>
                            <p class="text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏£‡∏π‡∏ó‡πà‡∏≤‡∏ô‡πÉ‡∏î‡∏•‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6">
                    <h2 class="text-2xl font-bold">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π</h2>
                    <p class="text-blue-100 mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏£‡∏π</p>
                    
                    <!-- Search and Filter -->
                    <div class="mt-4 flex flex-wrap gap-4">
                        <div class="flex-1 min-w-64">
                            <input type="text" id="searchTeacher" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π..." class="w-full p-3 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
                        </div>
                        <div>
                            <select id="filterLeaveType" class="p-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
                                <option value="">üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">üèÉ‚Äç‚ôÇÔ∏è ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                                <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">ü§í ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                                <option value="‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î">üë∂ ‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î</option>
                            </select>
                        </div>
                        <div>
                            <button id="clearFilters" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg transition duration-200 flex items-center space-x-2">
                                <span>üîÑ</span>
                                <span>‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Summary Table -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏•‡∏≤‡∏Å‡∏¥‡∏à<br><span class="text-xs text-gray-500">(‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ß‡∏±‡∏ô)</span></th>
                                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢<br><span class="text-xs text-gray-500">(‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ß‡∏±‡∏ô)</span></th>
                                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î<br><span class="text-xs text-gray-500">(‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ß‡∏±‡∏ô)</span></th>
                                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</th>
                                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
                            </tr>
                        </thead>
                        <tbody id="teacherTable" class="divide-y divide-gray-200">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Teacher Detail Page -->
        <div id="detailPage" class="hidden">
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 id="teacherDetailName" class="text-2xl font-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h2>
                            <p id="teacherDetailPosition" class="text-purple-100 mt-1"></p>
                        </div>
                        <button id="backToHome" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-200">
                            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="leaveDetailsList" class="space-y-4">
                        <!-- Leave details will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Management Page -->
        <div id="teacherManagePage" class="hidden">
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6">
                    <h2 class="text-2xl font-bold">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</h2>
                    <p class="text-indigo-100 mt-1">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</p>
                </div>
                
                <div class="p-6">
                    <!-- Add Teacher Form -->
                    <div class="mb-8 bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π‡πÉ‡∏´‡∏°‡πà</h3>
                        <form id="teacherForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="teacherName" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏ô‡∏≤‡∏¢/‡∏ô‡∏≤‡∏á/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                                <input type="text" id="teacherPosition" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ Username</label>
                                <input type="text" id="teacherUsername" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">üîí Password</label>
                                <input type="password" id="teacherPassword" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">‚≠ê User Level</label>
                                <select id="teacherUserLevel" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ --</option>
                                    <option value="admin">üëë Admin (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)</option>
                                    <option value="manager">üè¢ Manager (‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£)</option>
                                    <option value="teacher">üë®‚Äçüè´ Teacher (‡∏Ñ‡∏£‡∏π)</option>
                                    <option value="viewer">üëÅÔ∏è Viewer (‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-teal-700 transition duration-200">
                                    üíæ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Teachers List -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full bg-white border border-gray-200 rounded-lg">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Username</th>
                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Password</th>
                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">User Level</th>
                                        <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody id="teacherManageTable" class="divide-y divide-gray-200">
                                    <!-- Teachers will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Leave Page -->
        <div id="addPage" class="hidden">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-xl card-shadow overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-teal-600 text-white p-6">
                        <h2 class="text-2xl font-bold">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏•‡∏≤</h2>
                        <p class="text-green-100 mt-1">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π</p>
                    </div>
                    
                    <form id="leaveForm" class="p-8 space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üë®‚Äçüè´ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π</label>
                            <select id="teacherSelect" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏π --</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                            <select id="leaveType" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤ --</option>
                                <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">üèÉ‚Äç‚ôÇÔ∏è ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                                <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">ü§í ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                                <option value="‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î">üë∂ ‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤</label>
                                <input type="date" id="startDate" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                                <input type="date" id="endDate" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" required>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üìù ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                            <textarea id="leaveReason" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700 h-24 resize-none" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏•‡∏≤..." required></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üìû ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏•‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà</label>
                            <input type="text" id="contactInfo" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ" required>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</label>
                            <select id="approvalStatus" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700">
                                <option value="pending">‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                                <option value="approved">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            </select>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-semibold text-gray-700">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:</span>
                                <span id="dayCount" class="text-2xl font-bold text-blue-600">0 ‡∏ß‡∏±‡∏ô</span>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-4 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-teal-700 transition duration-200 hover-scale">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center card-shadow">
            <div class="text-6xl mb-4">‚úÖ</div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p class="text-gray-600 mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <button id="closeModal" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <!-- Edit Teacher Modal -->
    <div id="editTeacherModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-md mx-4 w-full card-shadow">
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6">
                <h3 class="text-xl font-bold">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</h3>
            </div>
            
            <form id="editTeacherForm" class="p-6 space-y-4">
                <input type="hidden" id="editTeacherId">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="editTeacherName" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input type="text" id="editTeacherPosition" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ Username</label>
                    <input type="text" id="editTeacherUsername" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üîí Password</label>
                    <input type="password" id="editTeacherPassword" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‚≠ê User Level</label>
                    <select id="editTeacherUserLevel" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                        <option value="admin">üëë Admin (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)</option>
                        <option value="manager">üè¢ Manager (‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£)</option>
                        <option value="teacher">üë®‚Äçüè´ Teacher (‡∏Ñ‡∏£‡∏π)</option>
                        <option value="viewer">üëÅÔ∏è Viewer (‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</option>
                    </select>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-teal-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button type="button" id="cancelEditTeacher" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="userProfileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-md mx-4 w-full card-shadow">
            <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-6">
                <h3 class="text-xl font-bold">üë§ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
            </div>
            
            <form id="userProfileForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="profileName" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input type="text" id="profilePosition" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ Username</label>
                    <input type="text" id="profileUsername" class="w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-500" readonly title="‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Username ‡πÑ‡∏î‡πâ">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üîí ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input type="password" id="profilePassword" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üîí ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input type="password" id="profilePasswordConfirm" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‚≠ê User Level</label>
                    <select id="profileUserLevel" class="w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-500" disabled>
                        <option value="admin">üëë Admin (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)</option>
                        <option value="manager">üè¢ Manager (‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£)</option>
                        <option value="teacher">üë®‚Äçüè´ Teacher (‡∏Ñ‡∏£‡∏π)</option>
                        <option value="viewer">üëÅÔ∏è Viewer (‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">* ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</p>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-teal-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button type="button" id="cancelUserProfile" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Leave Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-2xl mx-4 w-full max-h-[90vh] overflow-y-auto card-shadow">
            <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-6">
                <h3 class="text-xl font-bold">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3>
            </div>
            
            <form id="editForm" class="p-6 space-y-4">
                <input type="hidden" id="editLeaveId">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                    <select id="editLeaveType" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                        <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">üèÉ‚Äç‚ôÇÔ∏è ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                        <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">ü§í ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î">üë∂ ‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤</label>
                        <input type="date" id="editStartDate" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" id="editEndDate" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" required>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üìù ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                    <textarea id="editLeaveReason" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700 h-20 resize-none" required></textarea>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üìû ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏•‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà</label>
                    <input type="text" id="editContactInfo" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700" required>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</label>
                    <select id="editApprovalStatus" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-gray-700">
                        <option value="pending">‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                        <option value="approved">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                    </select>
                </div>

                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-semibold text-gray-700">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:</span>
                        <span id="editDayCount" class="text-xl font-bold text-blue-600">0 ‡∏ß‡∏±‡∏ô</span>
                    </div>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-teal-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button type="button" id="cancelEdit" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center card-shadow">
            <div class="text-6xl mb-4">‚ùì</div>
            <h3 id="confirmTitle" class="text-xl font-bold text-gray-800 mb-2"></h3>
            <p id="confirmMessage" class="text-gray-600 mb-6"></p>
            <div class="flex gap-3">
                <button id="confirmYes" class="flex-1 bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition duration-200">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                <button id="confirmNo" class="flex-1 bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-200">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center card-shadow">
            <div id="messageIcon" class="text-6xl mb-4"></div>
            <h3 id="messageTitle" class="text-xl font-bold text-gray-800 mb-2"></h3>
            <p id="messageText" class="text-gray-600 mb-6"></p>
            <button id="messageOk" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBil_922dH9E_iDx9PEFmj1BxseJF7HMwQ",
            authDomain: "mow-leave.firebaseapp.com",
            projectId: "mow-leave",
            storageBucket: "mow-leave.firebasestorage.app",
            messagingSenderId: ".",
            appId: "1:.:web:d6735ee0ad71c6a8ef2e98",
            measurementId: "G-NL4GSNQKXX"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Firebase Database Functions
        const FirebaseDB = {
            // Get all documents from a collection
            get: async (collection) => {
                try {
                    const snapshot = await db.collection(collection).get();
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error getting documents:', error);
                    return [];
                }
            },

            // Add a new document to a collection
            add: async (collection, data) => {
                try {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    const docRef = await db.collection(collection).add(data);
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding document:', error);
                    throw error;
                }
            },

            // Update a document in a collection
            update: async (collection, id, updates) => {
                try {
                    updates.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection(collection).doc(id).update(updates);
                    return true;
                } catch (error) {
                    console.error('Error updating document:', error);
                    throw error;
                }
            },

            // Delete a document from a collection
            delete: async (collection, id) => {
                try {
                    await db.collection(collection).doc(id).delete();
                    return true;
                } catch (error) {
                    console.error('Error deleting document:', error);
                    throw error;
                }
            },

            // Get documents with real-time updates
            onSnapshot: (collection, callback) => {
                return db.collection(collection).onSnapshot(snapshot => {
                    const data = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    callback(data);
                });
            }
        };

        // Teachers data - will be loaded from database
        let teachers = [];

        // DOM Elements
        const homeTab = document.getElementById('homeTab');
        const addTab = document.getElementById('addTab');
        const teacherManageTab = document.getElementById('teacherManageTab');
        const detailTab = document.getElementById('detailTab');
        const homePage = document.getElementById('homePage');
        const addPage = document.getElementById('addPage');
        const teacherManagePage = document.getElementById('teacherManagePage');
        const detailPage = document.getElementById('detailPage');
        const teacherSelect = document.getElementById('teacherSelect');
        const leaveForm = document.getElementById('leaveForm');
        const startDate = document.getElementById('startDate');
        const endDate = document.getElementById('endDate');
        const dayCount = document.getElementById('dayCount');
        const successModal = document.getElementById('successModal');
        const closeModal = document.getElementById('closeModal');
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const backToHome = document.getElementById('backToHome');
        const cancelEdit = document.getElementById('cancelEdit');
        const teacherForm = document.getElementById('teacherForm');
        const editTeacherModal = document.getElementById('editTeacherModal');
        const editTeacherForm = document.getElementById('editTeacherForm');
        const cancelEditTeacher = document.getElementById('cancelEditTeacher');
        const userProfileModal = document.getElementById('userProfileModal');
        const userProfileForm = document.getElementById('userProfileForm');
        const cancelUserProfile = document.getElementById('cancelUserProfile');

        // Global variables
        let allLeaves = [];
        let currentTeacher = null;
        let currentUser = null;

        // Modal Functions
        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.remove('hidden');
            document.getElementById('confirmModal').classList.add('flex');
            
            const confirmYes = document.getElementById('confirmYes');
            const confirmNo = document.getElementById('confirmNo');
            
            const handleYes = () => {
                hideConfirmModal();
                onConfirm();
                confirmYes.removeEventListener('click', handleYes);
                confirmNo.removeEventListener('click', handleNo);
            };
            
            const handleNo = () => {
                hideConfirmModal();
                confirmYes.removeEventListener('click', handleYes);
                confirmNo.removeEventListener('click', handleNo);
            };
            
            confirmYes.addEventListener('click', handleYes);
            confirmNo.addEventListener('click', handleNo);
        }

        function hideConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
            document.getElementById('confirmModal').classList.remove('flex');
        }

        function showSuccessMessage(message) {
            document.getElementById('messageIcon').textContent = '‚úÖ';
            document.getElementById('messageTitle').textContent = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            document.getElementById('messageText').textContent = message;
            document.getElementById('messageModal').classList.remove('hidden');
            document.getElementById('messageModal').classList.add('flex');
        }

        function showErrorMessage(message) {
            document.getElementById('messageIcon').textContent = '‚ùå';
            document.getElementById('messageTitle').textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!';
            document.getElementById('messageText').textContent = message;
            document.getElementById('messageModal').classList.remove('hidden');
            document.getElementById('messageModal').classList.add('flex');
        }

        function hideMessageModal() {
            document.getElementById('messageModal').classList.add('hidden');
            document.getElementById('messageModal').classList.remove('flex');
        }

        function showLoadingMessage(message) {
            document.getElementById('messageIcon').textContent = '‚è≥';
            document.getElementById('messageTitle').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            document.getElementById('messageText').textContent = message;
            document.getElementById('messageOk').style.display = 'none';
            document.getElementById('messageModal').classList.remove('hidden');
            document.getElementById('messageModal').classList.add('flex');
        }

        function hideLoadingMessage() {
            document.getElementById('messageOk').style.display = 'inline-block';
            hideMessageModal();
        }

        // Message modal event listeners
        document.getElementById('messageOk').addEventListener('click', hideMessageModal);
        document.getElementById('messageModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('messageModal')) {
                hideMessageModal();
            }
        });

        // Confirm modal event listeners
        document.getElementById('confirmModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('confirmModal')) {
                hideConfirmModal();
            }
        });

        // Initialize
        initializeApp();

        // Initialize application
        async function initializeApp() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                await showMainApp();
            } else {
                showLoginPage();
            }
        }

        // Show login page
        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // Show main application
        async function showMainApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info in header
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserLevel').textContent = getUserLevelText(currentUser.userLevel);
            
            // Setup logout button
            setupLogoutButton();
            
            // Load data and setup UI based on user level
            await loadTeachers();
            await loadTeacherData();
            setupUIBasedOnUserLevel();
        }

        // Login form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...');
                
                // Load teachers if not already loaded
                if (teachers.length === 0) {
                    await loadTeachers();
                }
                
                // Find user
                const user = teachers.find(t => t.username === username && t.password === password);
                
                hideLoadingMessage();
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    document.getElementById('loginError').classList.add('hidden');
                    await showMainApp();
                } else {
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (error) {
                hideLoadingMessage();
                console.error('Login error:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            }
        });

        // Logout function
        function logout() {
            showConfirmModal('üö™ ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ', () => {
                // Clear user data
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // Reset all forms and states
                document.getElementById('loginForm').reset();
                document.getElementById('loginError').classList.add('hidden');
                
                // Reset current teacher
                currentTeacher = null;
                
                // Hide all modals
                hideEditModal();
                hideEditTeacherModal();
                hideUserProfileModal();
                successModal.classList.add('hidden');
                successModal.classList.remove('flex');
                
                // Clear all form data
                if (document.getElementById('leaveForm')) {
                    document.getElementById('leaveForm').reset();
                }
                if (document.getElementById('teacherForm')) {
                    document.getElementById('teacherForm').reset();
                }
                
                // Reset day count
                if (document.getElementById('dayCount')) {
                    document.getElementById('dayCount').textContent = '0 ‡∏ß‡∏±‡∏ô';
                }
                
                // Reset to login page
                showLoginPage();
                
                // Reset tab states
                switchToTab('home');
                detailTab.classList.add('hidden');
                
                // Show logout success message briefly
                setTimeout(() => {
                    showSuccessMessage('‚úÖ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }, 100);
            });
        }
        
        // Setup logout button event listener
        function setupLogoutButton() {
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }
        }

        // Show user profile modal
        function showUserProfile() {
            if (!currentUser) return;
            
            // Populate form with current user data
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profilePosition').value = currentUser.position || '';
            document.getElementById('profileUsername').value = currentUser.username || '';
            document.getElementById('profilePassword').value = '';
            document.getElementById('profilePasswordConfirm').value = '';
            document.getElementById('profileUserLevel').value = currentUser.userLevel || 'teacher';
            
            showUserProfileModal();
        }

        function showUserProfileModal() {
            userProfileModal.classList.remove('hidden');
            userProfileModal.classList.add('flex');
        }

        function hideUserProfileModal() {
            userProfileModal.classList.add('hidden');
            userProfileModal.classList.remove('flex');
        }

        // Setup UI based on user level
        function setupUIBasedOnUserLevel() {
            const userLevel = currentUser.userLevel;
            
            // Hide all tabs first
            homeTab.style.display = 'none';
            addTab.style.display = 'none';
            teacherManageTab.style.display = 'none';
            
            // Show tabs based on user level
            if (userLevel === 'admin') {
                // Admin can see everything
                homeTab.style.display = 'inline-block';
                addTab.style.display = 'inline-block';
                teacherManageTab.style.display = 'inline-block';
                switchToTab('home');
            } else if (userLevel === 'manager') {
                // Manager can see all data, add leave, and approve leave
                homeTab.style.display = 'inline-block';
                addTab.style.display = 'inline-block';
                switchToTab('home');
            } else if (userLevel === 'teacher') {
                // Teacher can see their own data and add their own leave
                homeTab.style.display = 'inline-block';
                addTab.style.display = 'inline-block';
                switchToTab('home');
                
                // Modify home tab to show only their data
                homeTab.textContent = 'üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô';
            } else if (userLevel === 'viewer') {
                // Viewer can see all data and add leave for others
                homeTab.style.display = 'inline-block';
                addTab.style.display = 'inline-block';
                switchToTab('home');
            }
        }

        // Tab switching
        homeTab.addEventListener('click', () => {
            switchToTab('home');
        });

        addTab.addEventListener('click', () => {
            switchToTab('add');
        });

        teacherManageTab.addEventListener('click', () => {
            switchToTab('teacherManage');
        });

        detailTab.addEventListener('click', () => {
            switchToTab('detail');
        });

        backToHome.addEventListener('click', () => {
            switchToTab('home');
            detailTab.classList.add('hidden');
        });

        function switchToTab(tab) {
            // Reset all tabs
            [homeTab, addTab, teacherManageTab, detailTab].forEach(t => {
                t.classList.remove('bg-blue-500', 'text-white');
                t.classList.add('text-gray-600');
            });
            
            // Hide all pages
            [homePage, addPage, teacherManagePage, detailPage].forEach(p => {
                p.classList.add('hidden');
            });

            // Show selected tab and page
            switch(tab) {
                case 'home':
                    homeTab.classList.add('bg-blue-500', 'text-white');
                    homeTab.classList.remove('text-gray-600');
                    homePage.classList.remove('hidden');
                    break;
                case 'add':
                    addTab.classList.add('bg-blue-500', 'text-white');
                    addTab.classList.remove('text-gray-600');
                    addPage.classList.remove('hidden');
                    break;
                case 'teacherManage':
                    teacherManageTab.classList.add('bg-blue-500', 'text-white');
                    teacherManageTab.classList.remove('text-gray-600');
                    teacherManagePage.classList.remove('hidden');
                    break;
                case 'detail':
                    detailTab.classList.add('bg-blue-500', 'text-white');
                    detailTab.classList.remove('text-gray-600');
                    detailPage.classList.remove('hidden');
                    break;
            }
        }

        // Load teachers from Firebase
        async function loadTeachers() {
            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π...');
                teachers = await FirebaseDB.get('teachers');
                
                // If no teachers in Firebase, add default teachers
                if (teachers.length === 0) {
                    await addDefaultTeachers();
                    teachers = await FirebaseDB.get('teachers');
                }

                populateTeacherSelect();
                displayTeachersInManagePage();
                hideLoadingMessage();
            } catch (error) {
                console.error('Error loading teachers:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π');
                hideLoadingMessage();
            }
        }

        // Add default teachers to Firebase
        async function addDefaultTeachers() {
            const defaultTeachers = [
                { name: "‡∏ô‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ‡∏†‡∏π‡∏°‡∏¥ ‡∏°‡∏ì‡∏µ‡∏ß‡∏£‡∏£‡∏ì", position: "‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", username: "pakpoom", password: "123456", userLevel: "admin" },
                { name: "‡∏ô‡∏≤‡∏á‡∏ô‡∏ß‡∏•‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏Å‡∏±‡∏ô‡∏ó‡∏£", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", username: "nuanjan", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏û‡∏á‡∏®‡∏Å‡∏£ ‡∏≠‡∏∏‡∏õ‡∏•‡∏∞", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", username: "pongsakorn", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏≠‡∏†‡∏¥‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏ó‡∏û‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", username: "apisit", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏≠‡∏†‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏Å‡∏∂‡∏°‡∏£‡∏±‡∏°‡∏¢‡πå", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", username: "apichat", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏£‡∏¥‡∏ä ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏≠‡∏°", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "jakkrit", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏á‡∏Å‡∏°‡∏•‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‡∏â‡∏≤‡∏¢‡∏≤‡∏Å‡∏∏‡∏•", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "kamollak", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ä‡∏±‡∏¢ ‡∏¢‡∏≤‡∏°‡∏µ", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "pichai", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ï‡∏≤", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "kiatisak", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥ ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "kitti", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏≠‡∏£‡∏£‡∏ñ‡∏û‡∏á‡∏©‡πå ‡∏Ñ‡∏≥‡∏ß‡∏¥‡∏•‡∏±‡∏¢", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "attapong", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏£‡∏û‡∏¥‡∏ó‡∏¢‡∏≤ ‡∏°‡∏´‡∏≤‡∏°‡∏¥‡∏ï‡∏£", position: "‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£", username: "pornpitya", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏ô‡∏¥‡∏†‡∏£‡∏ì‡πå ‡∏ò‡∏ß‡∏±‡∏ä‡∏§‡∏Å‡∏©‡πå", position: "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£", username: "taniporn", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏£‡∏±‡∏ä‡∏£‡∏¥‡∏©‡∏≤ ‡∏£‡∏¥‡∏ô‡∏¢‡∏®", position: "‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á", username: "ratchrisa", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏±‡∏ç‡∏ä‡∏ô‡∏Å‡∏û‡∏£ ‡∏®‡∏£‡∏µ‡∏¢‡∏≠‡∏î", position: "‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á", username: "tanchanok", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏¢‡∏†‡∏≤‡∏ô‡∏∏‡∏û‡∏á‡∏®‡πå ‡∏°‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô", position: "‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á", username: "panupong", password: "123456", userLevel: "teacher" },
                { name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏±‡∏î‡∏ä‡∏≤ ‡∏™‡∏∏‡∏ò‡∏¥‡∏ä‡∏≤‡∏ô‡∏ô‡∏ó‡πå", position: "‡∏Ñ‡∏£‡∏π‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£", username: "padcha", password: "123456", userLevel: "viewer" }
            ];

            try {
                for (const teacher of defaultTeachers) {
                    await FirebaseDB.add('teachers', teacher);
                }
            } catch (error) {
                console.error('Error adding default teachers:', error);
                throw error;
            }
        }

        // Populate teacher select
        function populateTeacherSelect() {
            teacherSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏π --</option>';
            
            let teachersToShow = teachers;
            
            // If user is teacher, show only themselves
            if (currentUser && currentUser.userLevel === 'teacher') {
                teachersToShow = teachers.filter(teacher => teacher.name === currentUser.name);
                // Auto-select the teacher
                if (teachersToShow.length > 0) {
                    setTimeout(() => {
                        teacherSelect.value = teachersToShow[0].name;
                    }, 100);
                }
            }
            
            teachersToShow.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.name;
                option.textContent = `${teacher.name} (${teacher.position})`;
                teacherSelect.appendChild(option);
            });
        }

        // Helper functions for user level display
        function getUserLevelStyle(userLevel) {
            switch(userLevel) {
                case 'admin': return 'bg-red-100 text-red-800';
                case 'manager': return 'bg-purple-100 text-purple-800';
                case 'teacher': return 'bg-blue-100 text-blue-800';
                case 'viewer': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getUserLevelText(userLevel) {
            switch(userLevel) {
                case 'admin': return 'üëë Admin';
                case 'manager': return 'üè¢ Manager';
                case 'teacher': return 'üë®‚Äçüè´ Teacher';
                case 'viewer': return 'üëÅÔ∏è Viewer';
                default: return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            }
        }

        // Display teachers in management page
        function displayTeachersInManagePage() {
            const tableBody = document.getElementById('teacherManageTable');
            tableBody.innerHTML = '';

            teachers.forEach((teacher, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm text-gray-900">${index + 1}</td>
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${teacher.name}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">${teacher.position}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">${teacher.username || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                        <span class="inline-flex items-center px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">
                            ${'*'.repeat((teacher.password || '').length)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getUserLevelStyle(teacher.userLevel)}">
                            ${getUserLevelText(teacher.userLevel)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        ${currentUser && currentUser.userLevel === 'admin' ? `
                            <button onclick="editTeacher('${teacher.id}')" class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition duration-200 text-sm font-medium mr-2">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button onclick="deleteTeacher('${teacher.id}', '${teacher.name}')" class="inline-flex items-center px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition duration-200 text-sm font-medium">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        ` : '<span class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</span>'}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Calculate days between dates
        function calculateDays() {
            const start = new Date(startDate.value);
            const end = new Date(endDate.value);
            
            if (start && end && end >= start) {
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                dayCount.textContent = `${diffDays} ‡∏ß‡∏±‡∏ô`;
                return diffDays;
            } else {
                dayCount.textContent = '0 ‡∏ß‡∏±‡∏ô';
                return 0;
            }
        }

        startDate.addEventListener('change', calculateDays);
        endDate.addEventListener('change', calculateDays);

        // Teacher form submission
        teacherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Check permission - only admin can add teachers
            if (currentUser.userLevel !== 'admin') {
                showErrorMessage('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π‡πÉ‡∏´‡∏°‡πà');
                return;
            }
            
            const username = document.getElementById('teacherUsername').value;
            
            // Check if username already exists
            const existingTeacher = teachers.find(t => t.username === username);
            if (existingTeacher) {
                showErrorMessage('Username ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Username ‡∏≠‡∏∑‡πà‡∏ô');
                return;
            }
            
            const teacherData = {
                name: document.getElementById('teacherName').value,
                position: document.getElementById('teacherPosition').value,
                username: username,
                password: document.getElementById('teacherPassword').value,
                userLevel: document.getElementById('teacherUserLevel').value
            };

            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π‡πÉ‡∏´‡∏°‡πà...');
                await FirebaseDB.add('teachers', teacherData);
                teacherForm.reset();
                await loadTeachers();
                hideLoadingMessage();
                showSuccessMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } catch (error) {
                hideLoadingMessage();
                console.error('Error adding teacher:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π');
            }
        });

        // Form submission
        leaveForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validate form data
            const teacherName = teacherSelect.value;
            const leaveType = document.getElementById('leaveType').value;
            const startDateValue = startDate.value;
            const endDateValue = endDate.value;
            const leaveReason = document.getElementById('leaveReason').value.trim();
            const contactInfo = document.getElementById('contactInfo').value.trim();
            
            // Check if all required fields are filled
            if (!teacherName || !leaveType || !startDateValue || !endDateValue || !leaveReason || !contactInfo) {
                showErrorMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            // Check if end date is not before start date
            const startDateObj = new Date(startDateValue);
            const endDateObj = new Date(endDateValue);
            
            if (endDateObj < startDateObj) {
                showErrorMessage('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤');
                return;
            }
            
            // Check if dates are not in the future (more than 1 year)
            const today = new Date();
            const oneYearFromNow = new Date();
            oneYearFromNow.setFullYear(today.getFullYear() + 1);
            
            if (startDateObj > oneYearFromNow) {
                showErrorMessage('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏õ‡∏µ‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }
            
            const formData = {
                teacherName: teacherName,
                leaveType: leaveType,
                startDate: startDateValue,
                endDate: endDateValue,
                days: calculateDays(),
                leaveReason: leaveReason,
                contactInfo: contactInfo,
                approvalStatus: document.getElementById('approvalStatus').value || 'pending',
                submittedBy: currentUser.name,
                submittedAt: new Date().toISOString()
            };

            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤...');
                await FirebaseDB.add('leaves', formData);
                showSuccessModal();
                leaveForm.reset();
                dayCount.textContent = '0 ‡∏ß‡∏±‡∏ô';
                await loadTeacherData();
                hideLoadingMessage();
            } catch (error) {
                hideLoadingMessage();
                console.error('Error adding leave:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        });

        // Load teacher data
        async function loadTeacherData() {
            try {
                allLeaves = await FirebaseDB.get('leaves');
                displayTeacherData(allLeaves);
            } catch (error) {
                console.error('Error loading teacher data:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤');
            }
        }

        // Filter and search functions
        function filterTeacherData() {
            const searchTerm = document.getElementById('searchTeacher').value.toLowerCase();
            const filterType = document.getElementById('filterLeaveType').value;
            
            let filteredLeaves = allLeaves;
            
            // Filter by leave type if selected
            if (filterType) {
                filteredLeaves = filteredLeaves.filter(leave => leave.leaveType === filterType);
            }
            
            // Filter by search term if provided
            if (searchTerm) {
                filteredLeaves = filteredLeaves.filter(leave => 
                    leave.teacherName.toLowerCase().includes(searchTerm)
                );
            }
            
            displayTeacherData(filteredLeaves);
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('searchTeacher').value = '';
            document.getElementById('filterLeaveType').value = '';
            displayTeacherData(allLeaves);
        }



        // Display pending approvals table
        function displayPendingApprovals(leaves) {
            let pendingLeaves = leaves.filter(leave => leave.approvalStatus === 'pending');
            const pendingSection = document.getElementById('pendingApprovalsSection');
            const pendingTable = document.getElementById('pendingApprovalsTable');
            const noPendingMessage = document.getElementById('noPendingMessage');
            const pendingCount = document.getElementById('pendingCount');
            
            // Filter for teacher level - show only their own pending leaves
            if (currentUser && currentUser.userLevel === 'teacher') {
                pendingLeaves = pendingLeaves.filter(leave => leave.teacherName === currentUser.name);
            }
            
            // Update count
            pendingCount.textContent = `${pendingLeaves.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            // Show section for all user levels
            pendingSection.style.display = 'block';
            
            if (pendingLeaves.length === 0) {
                pendingTable.style.display = 'none';
                noPendingMessage.classList.remove('hidden');
                return;
            }
            
            pendingTable.style.display = 'table-row-group';
            noPendingMessage.classList.add('hidden');
            
            // Sort by submission date (newest first)
            pendingLeaves.sort((a, b) => {
                const dateA = new Date(a.submittedAt || a.createdAt);
                const dateB = new Date(b.submittedAt || b.createdAt);
                return dateB - dateA;
            });
            
            pendingTable.innerHTML = '';
            
            const typeColor = {
                '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 'bg-blue-100 text-blue-800',
                '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 'bg-red-100 text-red-800',
                '‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î': 'bg-pink-100 text-pink-800'
            };
            
            pendingLeaves.forEach(leave => {
                const submittedDate = leave.submittedAt ? new Date(leave.submittedAt) : new Date(leave.createdAt);
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-600">
                        ${submittedDate.toLocaleDateString('th-TH', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </td>
                    <td class="px-4 py-3">
                        <div class="font-medium text-gray-900">${leave.teacherName}</div>
                        <div class="text-sm text-gray-500">${getTeacherPosition(leave.teacherName)}</div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${typeColor[leave.leaveType] || 'bg-gray-100 text-gray-800'}">
                            ${leave.leaveType}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600">
                        <div>${formatDate(leave.startDate)}</div>
                        ${leave.startDate !== leave.endDate ? `<div class="text-xs text-gray-400">‡∏ñ‡∏∂‡∏á ${formatDate(leave.endDate)}</div>` : ''}
                    </td>
                    <td class="px-4 py-3 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700">
                            ${leave.days} ‡∏ß‡∏±‡∏ô
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600 max-w-xs">
                        <div class="truncate" title="${leave.leaveReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}">
                            ${leave.leaveReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${currentUser && currentUser.userLevel === 'manager' ? `
                            <div class="space-x-1">
                                <button onclick="approveLeaveFromPending('${leave.id}', 'approved')" class="inline-flex items-center px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium hover:bg-green-200 transition duration-200">
                                    ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                </button>
                                <button onclick="approveLeaveFromPending('${leave.id}', 'rejected')" class="inline-flex items-center px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium hover:bg-red-200 transition duration-200">
                                    ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                </button>
                            </div>
                        ` : `
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                ‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                            </span>
                        `}
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${canEditPendingLeave(leave) ? `
                            <button onclick="editLeave('${leave.id}')" class="inline-flex items-center px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-medium hover:bg-orange-200 transition duration-200">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                        ` : '<span class="text-gray-400 text-xs">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>'}
                    </td>
                `;
                
                pendingTable.appendChild(row);
            });
        }
        
        // Get teacher position by name
        function getTeacherPosition(teacherName) {
            const teacher = teachers.find(t => t.name === teacherName);
            return teacher ? teacher.position : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
        }
        
        // Approve leave from pending table
        async function approveLeaveFromPending(leaveId, status) {
            await approveLeave(leaveId, status);
        }

        // Display recent leaves table (last 5 days)
        function displayRecentLeaves(leaves) {
            const recentSection = document.getElementById('recentLeavesSection');
            const recentTable = document.getElementById('recentLeavesTable');
            const noRecentMessage = document.getElementById('noRecentMessage');
            const recentCount = document.getElementById('recentCount');
            
            // Calculate date 5 days ago
            const fiveDaysAgo = new Date();
            fiveDaysAgo.setDate(fiveDaysAgo.getDate() - 5);
            
            // Filter leaves from last 5 days
            let recentLeaves = leaves.filter(leave => {
                const leaveDate = new Date(leave.startDate);
                return leaveDate >= fiveDaysAgo;
            });
            
            // Filter for teacher level - show only their own recent leaves
            if (currentUser && currentUser.userLevel === 'teacher') {
                recentLeaves = recentLeaves.filter(leave => leave.teacherName === currentUser.name);
            }
            
            // Update count
            recentCount.textContent = `${recentLeaves.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            // Show section for all user levels
            recentSection.style.display = 'block';
            
            if (recentLeaves.length === 0) {
                recentTable.style.display = 'none';
                noRecentMessage.classList.remove('hidden');
                return;
            }
            
            recentTable.style.display = 'table-row-group';
            noRecentMessage.classList.add('hidden');
            
            // Sort by start date (newest first)
            recentLeaves.sort((a, b) => {
                const dateA = new Date(a.startDate);
                const dateB = new Date(b.startDate);
                return dateB - dateA;
            });
            
            recentTable.innerHTML = '';
            
            const typeColor = {
                '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 'bg-blue-100 text-blue-800',
                '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 'bg-red-100 text-red-800',
                '‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î': 'bg-pink-100 text-pink-800'
            };
            
            recentLeaves.forEach(leave => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const approvedDate = leave.approvedAt ? new Date(leave.approvedAt) : null;
                
                row.innerHTML = `
                    <td class="px-4 py-3">
                        <div class="font-medium text-gray-900">${leave.teacherName}</div>
                        <div class="text-sm text-gray-500">${getTeacherPosition(leave.teacherName)}</div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${typeColor[leave.leaveType] || 'bg-gray-100 text-gray-800'}">
                            ${leave.leaveType}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600">
                        <div>${formatDate(leave.startDate)}</div>
                        ${leave.startDate !== leave.endDate ? `<div class="text-xs text-gray-400">‡∏ñ‡∏∂‡∏á ${formatDate(leave.endDate)}</div>` : ''}
                    </td>
                    <td class="px-4 py-3 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700">
                            ${leave.days} ‡∏ß‡∏±‡∏ô
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600 max-w-xs">
                        <div class="truncate" title="${leave.leaveReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}">
                            ${leave.leaveReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${getApprovalStatusBadge(leave.approvalStatus)}
                        ${leave.approvedBy ? `<div class="text-xs text-gray-500 mt-1">‡πÇ‡∏î‡∏¢ ${leave.approvedBy}</div>` : ''}
                    </td>
                    <td class="px-4 py-3 text-center text-sm text-gray-600">
                        ${approvedDate ? `
                            <div>${formatDate(approvedDate.toISOString().split('T')[0])}</div>
                            <div class="text-xs text-gray-400">${approvedDate.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })}</div>
                        ` : '<span class="text-gray-400">-</span>'}
                    </td>
                `;
                
                recentTable.appendChild(row);
            });
        }

        // Display teacher data in table
        function displayTeacherData(leaves) {
            // Display pending approvals first
            displayPendingApprovals(leaves);
            
            // Display recent leaves
            displayRecentLeaves(leaves);
            
            const tableBody = document.getElementById('teacherTable');
            tableBody.innerHTML = '';

            let teachersToShow = teachers;
            
            // If user is teacher, show only their own data
            if (currentUser && currentUser.userLevel === 'teacher') {
                teachersToShow = teachers.filter(teacher => teacher.name === currentUser.name);
            }
            


            teachersToShow.forEach(teacher => {
                const teacherLeaves = leaves.filter(leave => leave.teacherName === teacher.name);
                
                // Calculate statistics
                const businessLeaves = teacherLeaves.filter(leave => leave.leaveType === '‡∏•‡∏≤‡∏Å‡∏¥‡∏à');
                const sickLeaves = teacherLeaves.filter(leave => leave.leaveType === '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢');
                const maternityLeaves = teacherLeaves.filter(leave => leave.leaveType === '‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î');
                
                const businessStats = {
                    count: businessLeaves.length,
                    days: businessLeaves.reduce((sum, leave) => sum + (leave.days || 0), 0)
                };
                
                const sickStats = {
                    count: sickLeaves.length,
                    days: sickLeaves.reduce((sum, leave) => sum + (leave.days || 0), 0)
                };
                
                const maternityStats = {
                    count: maternityLeaves.length,
                    days: maternityLeaves.reduce((sum, leave) => sum + (leave.days || 0), 0)
                };

                // Find last leave
                const lastLeave = teacherLeaves.sort((a, b) => {
                    const dateA = new Date(a.startDate);
                    const dateB = new Date(b.startDate);
                    return dateB - dateA;
                })[0];

                // Count pending approvals
                const pendingLeaves = teacherLeaves.filter(leave => leave.approvalStatus === 'pending');

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition duration-200" onclick="showTeacherDetail('${teacher.name}', '${teacher.position}')">${teacher.name}</div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">${teacher.position}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                            ${businessStats.count}/${businessStats.days}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                            ${sickStats.count}/${sickStats.days}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-100 text-pink-800">
                            ${maternityStats.count}/${maternityStats.days}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center text-sm">
                        ${lastLeave ? `
                            <div class="text-gray-900 font-medium">${lastLeave.leaveType}</div>
                            <div class="text-gray-500">${formatDate(lastLeave.startDate)}</div>
                            <div class="text-gray-500">${lastLeave.days} ‡∏ß‡∏±‡∏ô</div>
                        ` : '<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>'}
                    </td>
                    <td class="px-6 py-4 text-center">
                        ${pendingLeaves.length > 0 ? `
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                ${pendingLeaves.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                            </span>
                        ` : '<span class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ</span>'}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Show teacher detail
        function showTeacherDetail(teacherName, teacherPosition) {
            // Check if user has permission to view this teacher's detail
            if (currentUser.userLevel === 'teacher' && teacherName !== currentUser.name) {
                showErrorMessage('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡∏ó‡πà‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô');
                return;
            }
            
            currentTeacher = { name: teacherName, position: teacherPosition };
            
            document.getElementById('teacherDetailName').textContent = `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤ - ${teacherName}`;
            document.getElementById('teacherDetailPosition').textContent = teacherPosition;
            
            const teacherLeaves = allLeaves.filter(leave => leave.teacherName === teacherName);
            displayTeacherLeaves(teacherLeaves);
            
            detailTab.classList.remove('hidden');
            switchToTab('detail');
        }

        // Display teacher leaves
        function displayTeacherLeaves(leaves) {
            const container = document.getElementById('leaveDetailsList');
            container.innerHTML = '';

            if (leaves.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üìã</div>
                        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</p>
                    </div>
                `;
                return;
            }

            // Sort leaves by start date (newest first)
            leaves.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));

            // Create table
            const table = document.createElement('div');
            table.className = 'bg-white rounded-lg overflow-hidden border border-gray-200';
            
            const typeColor = {
                '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 'bg-blue-100 text-blue-800',
                '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 'bg-red-100 text-red-800',
                '‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î': 'bg-pink-100 text-pink-800'
            };

            table.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${leaves.map(leave => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-4 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${typeColor[leave.leaveType] || 'bg-gray-100 text-gray-800'}">
                                            ${leave.leaveType}
                                        </span>
                                    </td>
                                    <td class="px-4 py-4 text-sm text-gray-900">${formatDate(leave.startDate)}</td>
                                    <td class="px-4 py-4 text-sm text-gray-900">${formatDate(leave.endDate)}</td>
                                    <td class="px-4 py-4 text-center">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-sm font-medium bg-blue-50 text-blue-700">
                                            ${leave.days} ‡∏ß‡∏±‡∏ô
                                        </span>
                                    </td>
                                    <td class="px-4 py-4 text-sm text-gray-600 max-w-xs">
                                        <div class="truncate" title="${leave.leaveReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}">
                                            ${leave.leaveReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                                        </div>
                                    </td>
                                    <td class="px-4 py-4 text-sm text-gray-600">
                                        ${leave.contactInfo || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                                    </td>
                                    <td class="px-4 py-4 text-center">
                                        ${getApprovalStatusBadge(leave.approvalStatus)}
                                        ${canApproveLeave(leave) ? `
                                            <div class="mt-2 space-x-1">
                                                <button onclick="approveLeave('${leave.id}', 'approved')" class="inline-flex items-center px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium hover:bg-green-200 transition duration-200">
                                                    ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                                </button>
                                                <button onclick="approveLeave('${leave.id}', 'rejected')" class="inline-flex items-center px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium hover:bg-red-200 transition duration-200">
                                                    ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                                </button>
                                            </div>
                                        ` : ''}
                                    </td>
                                    <td class="px-4 py-4 text-center">
                                        ${canEditLeave(leave) ? `
                                            <button onclick="editLeave('${leave.id}')" class="inline-flex items-center px-3 py-1 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition duration-200 text-sm font-medium mr-2">
                                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                            </button>
                                            <button onclick="deleteLeave('${leave.id}', '${leave.leaveType}', '${formatDate(leave.startDate)}')" class="inline-flex items-center px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition duration-200 text-sm font-medium">
                                                üóëÔ∏è ‡∏•‡∏ö
                                            </button>
                                        ` : '<span class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ</span>'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.appendChild(table);
        }

        // Check if user can edit leave
        function canEditLeave(leave) {
            if (!currentUser) return false;
            
            if (currentUser.userLevel === 'admin') {
                return true; // Admin can edit everything
            } else if (currentUser.userLevel === 'teacher') {
                return leave.teacherName === currentUser.name; // Teacher can only edit their own
            } else if (currentUser.userLevel === 'viewer') {
                return false; // Viewer cannot edit
            }
            
            return false;
        }

        // Check if user can edit pending leave (for pending approvals table)
        function canEditPendingLeave(leave) {
            if (!currentUser) return false;
            
            if (currentUser.userLevel === 'admin') {
                return true; // Admin can edit all pending leaves
            } else if (currentUser.userLevel === 'teacher') {
                return leave.teacherName === currentUser.name; // Teacher can only edit their own pending leaves
            }
            
            return false;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Modal functions
        function showSuccessModal() {
            successModal.classList.remove('hidden');
            successModal.classList.add('flex');
        }

        // Teacher management functions
        function editTeacher(teacherId) {
            // Check permission - only admin can edit teachers
            if (currentUser.userLevel !== 'admin') {
                alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π');
                return;
            }
            
            const teacher = teachers.find(t => t.id === teacherId);
            if (!teacher) return;

            document.getElementById('editTeacherId').value = teacherId;
            document.getElementById('editTeacherName').value = teacher.name;
            document.getElementById('editTeacherPosition').value = teacher.position;
            document.getElementById('editTeacherUsername').value = teacher.username || '';
            document.getElementById('editTeacherPassword').value = teacher.password || '';
            document.getElementById('editTeacherUserLevel').value = teacher.userLevel || 'teacher';
            
            showEditTeacherModal();
        }

        function deleteTeacher(teacherId, teacherName) {
            // Check permission - only admin can delete teachers
            if (currentUser.userLevel !== 'admin') {
                showErrorMessage('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π');
                return;
            }
            
            showConfirmModal(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏£‡∏π "${teacherName}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`, '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', async () => {
                try {
                    showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π...');
                    await FirebaseDB.delete('teachers', teacherId);
                    await loadTeachers();
                    hideLoadingMessage();
                    showSuccessMessage('‡∏•‡∏ö‡∏Ñ‡∏£‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                } catch (error) {
                    hideLoadingMessage();
                    console.error('Error deleting teacher:', error);
                    showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏£‡∏π');
                }
            });
        }

        function showEditTeacherModal() {
            editTeacherModal.classList.remove('hidden');
            editTeacherModal.classList.add('flex');
        }

        function hideEditTeacherModal() {
            editTeacherModal.classList.add('hidden');
            editTeacherModal.classList.remove('flex');
        }

        // Edit teacher form submission
        editTeacherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const teacherId = document.getElementById('editTeacherId').value;
            const username = document.getElementById('editTeacherUsername').value;
            
            // Check if username already exists (excluding current teacher)
            const existingTeacher = teachers.find(t => t.username === username && t.id !== teacherId);
            if (existingTeacher) {
                showErrorMessage('Username ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Username ‡∏≠‡∏∑‡πà‡∏ô');
                return;
            }
            
            const updatedData = {
                name: document.getElementById('editTeacherName').value,
                position: document.getElementById('editTeacherPosition').value,
                username: username,
                password: document.getElementById('editTeacherPassword').value,
                userLevel: document.getElementById('editTeacherUserLevel').value
            };

            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π...');
                await FirebaseDB.update('teachers', teacherId, updatedData);
                hideEditTeacherModal();
                await loadTeachers();
                hideLoadingMessage();
                showSuccessMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } catch (error) {
                hideLoadingMessage();
                console.error('Error updating teacher:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π');
            }
        });

        // Teacher modal event listeners
        cancelEditTeacher.addEventListener('click', hideEditTeacherModal);
        
        editTeacherModal.addEventListener('click', (e) => {
            if (e.target === editTeacherModal) {
                hideEditTeacherModal();
            }
        });

        // Edit leave functions
        function editLeave(leaveId) {
            const leave = allLeaves.find(l => l.id === leaveId);
            if (!leave) return;

            // Check permission
            if (!canEditLeave(leave)) {
                showErrorMessage('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ô‡∏µ‡πâ');
                return;
            }

            // Populate edit form
            document.getElementById('editLeaveId').value = leaveId;
            document.getElementById('editLeaveType').value = leave.leaveType;
            document.getElementById('editStartDate').value = leave.startDate;
            document.getElementById('editEndDate').value = leave.endDate;
            document.getElementById('editLeaveReason').value = leave.leaveReason || '';
            document.getElementById('editContactInfo').value = leave.contactInfo || '';
            document.getElementById('editApprovalStatus').value = leave.approvalStatus || 'pending';
            
            calculateEditDays();
            showEditModal();
        }

        function calculateEditDays() {
            const start = new Date(document.getElementById('editStartDate').value);
            const end = new Date(document.getElementById('editEndDate').value);
            
            if (start && end && end >= start) {
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                document.getElementById('editDayCount').textContent = `${diffDays} ‡∏ß‡∏±‡∏ô`;
                return diffDays;
            } else {
                document.getElementById('editDayCount').textContent = '0 ‡∏ß‡∏±‡∏ô';
                return 0;
            }
        }

        function showEditModal() {
            editModal.classList.remove('hidden');
            editModal.classList.add('flex');
        }

        function hideEditModal() {
            editModal.classList.add('hidden');
            editModal.classList.remove('flex');
        }

        function switchToHomePage() {
            switchToTab('home');
            detailTab.classList.add('hidden');
        }

        closeModal.addEventListener('click', () => {
            successModal.classList.add('hidden');
            successModal.classList.remove('flex');
            switchToHomePage();
        });

        // Close modal when clicking outside
        successModal.addEventListener('click', (e) => {
            if (e.target === successModal) {
                successModal.classList.add('hidden');
                successModal.classList.remove('flex');
                switchToHomePage();
            }
        });

        // Edit modal event listeners
        cancelEdit.addEventListener('click', hideEditModal);
        
        document.getElementById('editStartDate').addEventListener('change', calculateEditDays);
        document.getElementById('editEndDate').addEventListener('change', calculateEditDays);

        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) {
                hideEditModal();
            }
        });

        // Delete leave function
        function deleteLeave(leaveId, leaveType, startDate) {
            showConfirmModal(
                `‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤ "${leaveType}"?`,
                `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤ ${leaveType} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${startDate} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                async () => {
                    try {
                        showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤...');
                        await FirebaseDB.delete('leaves', leaveId);
                        await loadTeacherData();
                        
                        // Refresh teacher detail view if currently viewing
                        if (currentTeacher) {
                            allLeaves = await FirebaseDB.get('leaves');
                            const teacherLeaves = allLeaves.filter(leave => leave.teacherName === currentTeacher.name);
                            displayTeacherLeaves(teacherLeaves);
                        }
                        
                        hideLoadingMessage();
                        showSuccessMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    } catch (error) {
                        hideLoadingMessage();
                        console.error('Error deleting leave:', error);
                        showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤');
                    }
                }
            );
        }

        // Edit form submission
        editForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validate edit form data
            const leaveType = document.getElementById('editLeaveType').value;
            const startDateValue = document.getElementById('editStartDate').value;
            const endDateValue = document.getElementById('editEndDate').value;
            const leaveReason = document.getElementById('editLeaveReason').value.trim();
            const contactInfo = document.getElementById('editContactInfo').value.trim();
            
            // Check if all required fields are filled
            if (!leaveType || !startDateValue || !endDateValue || !leaveReason || !contactInfo) {
                showErrorMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            // Check if end date is not before start date
            const startDateObj = new Date(startDateValue);
            const endDateObj = new Date(endDateValue);
            
            if (endDateObj < startDateObj) {
                showErrorMessage('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤');
                return;
            }
            
            const leaveId = document.getElementById('editLeaveId').value;
            const updatedData = {
                leaveType: leaveType,
                startDate: startDateValue,
                endDate: endDateValue,
                days: calculateEditDays(),
                leaveReason: leaveReason,
                contactInfo: contactInfo,
                approvalStatus: document.getElementById('editApprovalStatus').value
            };

            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤...');
                await FirebaseDB.update('leaves', leaveId, updatedData);
                hideEditModal();
                await loadTeacherData();
                
                // Refresh teacher detail view if currently viewing
                if (currentTeacher) {
                    allLeaves = await FirebaseDB.get('leaves');
                    const teacherLeaves = allLeaves.filter(leave => leave.teacherName === currentTeacher.name);
                    displayTeacherLeaves(teacherLeaves);
                }
                
                hideLoadingMessage();
                showSuccessMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } catch (error) {
                hideLoadingMessage();
                console.error('Error updating leave:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        });

        // User profile form submission
        userProfileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newPassword = document.getElementById('profilePassword').value;
            const confirmPassword = document.getElementById('profilePasswordConfirm').value;
            
            // Check password confirmation if password is being changed
            if (newPassword && newPassword !== confirmPassword) {
                showErrorMessage('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                return;
            }
            
            const updatedData = {
                name: document.getElementById('profileName').value,
                position: document.getElementById('profilePosition').value
            };
            
            // Add password to update if provided
            if (newPassword) {
                updatedData.password = newPassword;
            }

            try {
                showLoadingMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß...');
                await FirebaseDB.update('teachers', currentUser.id, updatedData);
                
                // Update current user data
                currentUser.name = updatedData.name;
                currentUser.position = updatedData.position;
                if (newPassword) {
                    currentUser.password = newPassword;
                }
                
                // Update localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Update header display
                document.getElementById('currentUserName').textContent = currentUser.name;
                
                hideUserProfileModal();
                await loadTeachers();
                await loadTeacherData();
                
                hideLoadingMessage();
                showSuccessMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } catch (error) {
                hideLoadingMessage();
                console.error('Error updating profile:', error);
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß');
            }
        });

        // User profile modal event listeners
        cancelUserProfile.addEventListener('click', hideUserProfileModal);
        
        userProfileModal.addEventListener('click', (e) => {
            if (e.target === userProfileModal) {
                hideUserProfileModal();
            }
        });

        // Approval functions
        function getApprovalStatusBadge(status) {
            switch(status) {
                case 'approved':
                    return '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>';
                case 'rejected':
                    return '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
                case 'pending':
                default:
                    return '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
            }
        }

        function canApproveLeave(leave) {
            if (!currentUser) return false;
            
            // Only managers can approve leave, and only if it's pending
            return currentUser.userLevel === 'manager' && leave.approvalStatus === 'pending';
        }

        async function approveLeave(leaveId, status) {
            const leave = allLeaves.find(l => l.id === leaveId);
            if (!leave) return;
            
            const statusText = status === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            
            showConfirmModal(
                `${statusText}‡∏Å‡∏≤‡∏£‡∏•‡∏≤?`,
                `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£${statusText}‡∏Å‡∏≤‡∏£‡∏•‡∏≤ ${leave.leaveType} ‡∏Ç‡∏≠‡∏á ${leave.teacherName} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                async () => {
                    try {
                        showLoadingMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á${statusText}‡∏Å‡∏≤‡∏£‡∏•‡∏≤...`);
                        
                        const updatedData = {
                            approvalStatus: status,
                            approvedBy: currentUser.name,
                            approvedAt: new Date().toISOString()
                        };
                        
                        await FirebaseDB.update('leaves', leaveId, updatedData);
                        await loadTeacherData();
                        
                        // Refresh teacher detail view if currently viewing
                        if (currentTeacher) {
                            allLeaves = await FirebaseDB.get('leaves');
                            const teacherLeaves = allLeaves.filter(leave => leave.teacherName === currentTeacher.name);
                            displayTeacherLeaves(teacherLeaves);
                        }
                        
                        hideLoadingMessage();
                        showSuccessMessage(`${statusText}‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                    } catch (error) {
                        hideLoadingMessage();
                        console.error('Error approving leave:', error);
                        showErrorMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£${statusText}‡∏Å‡∏≤‡∏£‡∏•‡∏≤`);
                    }
                }
            );
        }

        // Search and filter event listeners
        document.getElementById('searchTeacher').addEventListener('input', filterTeacherData);
        document.getElementById('filterLeaveType').addEventListener('change', filterTeacherData);
        document.getElementById('clearFilters').addEventListener('click', clearFilters);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97822b7741667dc6',t:'MTc1NjcwMjQ2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
